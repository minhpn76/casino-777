{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.persistenceDecorator = void 0;\n\nvar mobx_1 = require(\"mobx\");\n\nvar StorageConfiguration_1 = require(\"./StorageConfiguration\");\n\nvar utils_1 = require(\"./utils\");\n\nfunction getTargetPrototype(target) {\n  return utils_1.mobxNewestVersionSelect(function () {\n    return target;\n  }, // @ts-ignore\n  function () {\n    return target.prototype;\n  })();\n}\n\nfunction persistenceDecorator(options) {\n  var persistenceCreator = function persistenceCreator(options, skipSynchronization) {\n    return function (target) {\n      StorageConfiguration_1.StorageConfiguration.setAdapter(options.name, options.adapter);\n      var targetPrototype = getTargetPrototype(target);\n      var properties = options.properties;\n      var extendObservableWrapper = utils_1.mobxNewestVersionSelect(Object.assign, mobx_1.extendObservable);\n      var observableTargetPrototype = extendObservableWrapper(targetPrototype, {\n        _isPersistence: true,\n        _storageName: options.name,\n\n        get _asJS() {\n          return utils_1.getObservableTargetObject(targetPrototype, properties);\n        }\n\n      });\n      var disposer = mobx_1.reaction(utils_1.mobxNewestVersionSelect(function () {\n        return utils_1.getObservableTargetObject(targetPrototype, properties);\n      }, // @ts-ignore\n      function () {\n        return targetPrototype._asJS;\n      }), function (jsObject) {\n        return options.adapter.writeInStorage(options.name, jsObject);\n      }, options.reactionOptions);\n      StorageConfiguration_1.StorageConfiguration.setDisposers(targetPrototype, [disposer]);\n\n      if (!skipSynchronization) {\n        options.adapter.readFromStorage(options.name).then(mobx_1.action(function (content) {\n          if (content) {\n            utils_1.getObjectKeys(content).forEach(function (property) {\n              if (targetPrototype[property] instanceof mobx_1.ObservableMap) {\n                var targetPartial = targetPrototype[property];\n                var mapSource = utils_1.getObjectKeys(content[property]).reduce(function (p, k) {\n                  p.push([k, content[property][k]]);\n                  return p;\n                }, []);\n                var observableMap = new Map(mapSource);\n                targetPrototype[property] = observableMap;\n              } else {\n                targetPrototype[property] = content[property];\n              }\n            });\n          }\n\n          StorageConfiguration_1.StorageConfiguration.setIsSynchronized(targetPrototype, true);\n        }));\n      }\n\n      return utils_1.mobxNewestVersionSelect(function () {\n        return observableTargetPrototype;\n      }, function () {\n        return target;\n      })();\n    };\n  };\n\n  StorageConfiguration_1.StorageConfiguration.setStartPersist(options.name, function () {\n    return persistenceCreator(options, true);\n  });\n  return persistenceCreator(options);\n}\n\nexports.persistenceDecorator = persistenceDecorator;","map":{"version":3,"names":["Object","defineProperty","exports","value","persistenceDecorator","mobx_1","require","StorageConfiguration_1","utils_1","getTargetPrototype","target","mobxNewestVersionSelect","prototype","options","persistenceCreator","skipSynchronization","StorageConfiguration","setAdapter","name","adapter","targetPrototype","properties","extendObservableWrapper","assign","extendObservable","observableTargetPrototype","_isPersistence","_storageName","_asJS","getObservableTargetObject","disposer","reaction","jsObject","writeInStorage","reactionOptions","setDisposers","readFromStorage","then","action","content","getObjectKeys","forEach","property","ObservableMap","targetPartial","mapSource","reduce","p","k","push","observableMap","Map","setIsSynchronized","setStartPersist"],"sources":["/Users/m1/Desktop/source/2022/study-web3-smart-contract/casino-777/node_modules/mobx-persist-store/lib/persistenceDecorator.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.persistenceDecorator = void 0;\nconst mobx_1 = require(\"mobx\");\nconst StorageConfiguration_1 = require(\"./StorageConfiguration\");\nconst utils_1 = require(\"./utils\");\nfunction getTargetPrototype(target) {\n    return utils_1.mobxNewestVersionSelect(() => target, \n    // @ts-ignore\n    () => target.prototype)();\n}\nfunction persistenceDecorator(options) {\n    const persistenceCreator = (options, skipSynchronization) => (target) => {\n        StorageConfiguration_1.StorageConfiguration.setAdapter(options.name, options.adapter);\n        const targetPrototype = getTargetPrototype(target);\n        const properties = options.properties;\n        const extendObservableWrapper = utils_1.mobxNewestVersionSelect(Object.assign, mobx_1.extendObservable);\n        const observableTargetPrototype = extendObservableWrapper(targetPrototype, {\n            _isPersistence: true,\n            _storageName: options.name,\n            get _asJS() {\n                return utils_1.getObservableTargetObject(targetPrototype, properties);\n            },\n        });\n        const disposer = mobx_1.reaction(utils_1.mobxNewestVersionSelect(() => utils_1.getObservableTargetObject(targetPrototype, properties), \n        // @ts-ignore\n        () => targetPrototype._asJS), (jsObject) => options.adapter.writeInStorage(options.name, jsObject), options.reactionOptions);\n        StorageConfiguration_1.StorageConfiguration.setDisposers(targetPrototype, [disposer]);\n        if (!skipSynchronization) {\n            options.adapter.readFromStorage(options.name).then(mobx_1.action((content) => {\n                if (content) {\n                    utils_1.getObjectKeys(content).forEach((property) => {\n                        if (targetPrototype[property] instanceof mobx_1.ObservableMap) {\n                            const targetPartial = targetPrototype[property];\n                            const mapSource = utils_1.getObjectKeys(content[property]).reduce((p, k) => {\n                                p.push([k, content[property][k]]);\n                                return p;\n                            }, []);\n                            const observableMap = new Map(mapSource);\n                            targetPrototype[property] = observableMap;\n                        }\n                        else {\n                            targetPrototype[property] = content[property];\n                        }\n                    });\n                }\n                StorageConfiguration_1.StorageConfiguration.setIsSynchronized(targetPrototype, true);\n            }));\n        }\n        return utils_1.mobxNewestVersionSelect(() => observableTargetPrototype, () => target)();\n    };\n    StorageConfiguration_1.StorageConfiguration.setStartPersist(options.name, () => persistenceCreator(options, true));\n    return persistenceCreator(options);\n}\nexports.persistenceDecorator = persistenceDecorator;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}