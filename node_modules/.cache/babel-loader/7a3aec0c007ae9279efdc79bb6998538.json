{"ast":null,"code":"import _regeneratorRuntime from \"/Users/m1/Desktop/source/2022/study-web3-smart-contract/casino-777/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/m1/Desktop/source/2022/study-web3-smart-contract/casino-777/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _createClass from \"/Users/m1/Desktop/source/2022/study-web3-smart-contract/casino-777/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _classCallCheck from \"/Users/m1/Desktop/source/2022/study-web3-smart-contract/casino-777/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport { observable, action, makeObservable } from \"mobx\";\nimport { persistence, StorageAdapter, isPersistence } from \"mobx-persist-store\";\nimport { readStore, writeStore } from \"../common/helpers\";\nimport { nanoid } from \"nanoid\";\n\nvar AppStore = /*#__PURE__*/_createClass(function AppStore() {\n  var _this = this;\n\n  _classCallCheck(this, AppStore);\n\n  this.users = [];\n  this.username = null;\n  this.score = null;\n  this.history = [];\n\n  this.getUserIndex = function (name) {\n    return _this.users.findIndex(function (user) {\n      return user.username === name;\n    });\n  };\n\n  this.createUserAndLogin = function (name) {\n    var newUser = {\n      username: name,\n      score: 99.99,\n      history: []\n    };\n\n    _this.users.push(newUser);\n\n    _this.username = newUser.username;\n    _this.score = newUser.score;\n    _this.history = newUser.history;\n  };\n\n  this.login = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(name) {\n      var foundUserIndex, _yield$_this$users$fo, username, score, history;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              foundUserIndex = _this.getUserIndex(name);\n\n              if (!(foundUserIndex !== -1)) {\n                _context.next = 12;\n                break;\n              }\n\n              _context.next = 4;\n              return _this.users[foundUserIndex];\n\n            case 4:\n              _yield$_this$users$fo = _context.sent;\n              username = _yield$_this$users$fo.username;\n              score = _yield$_this$users$fo.score;\n              history = _yield$_this$users$fo.history;\n              _this.username = username;\n              _this.score = score;\n              _this.history = history;\n              return _context.abrupt(\"return\");\n\n            case 12:\n              _this.createUserAndLogin(name);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  this.logout = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _this.username = null;\n            _this.score = null;\n            _this.history = [];\n\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  this.updateUser = function (name) {\n    var foundUserIndex = _this.getUserIndex(name);\n\n    _this.users[foundUserIndex] = {\n      username: _this.username,\n      score: _this.score,\n      history: _this.history\n    };\n  };\n\n  this.updateHistory = function (slots) {\n    var draw = {\n      id: nanoid(),\n      slots: slots.join(\" \"),\n      time: new Date().toLocaleTimeString()\n    };\n\n    _this.history.push(draw);\n  };\n\n  this.spin = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(_ref3) {\n      var amount, slots;\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              amount = _ref3.amount, slots = _ref3.slots;\n              // spin fee\n              _this.score -= 1;\n              _this.score = (_this.score + amount).toFixed(2);\n              _context3.next = 5;\n              return _this.updateHistory(slots);\n\n            case 5:\n              // update user in users array\n              _this.updateUser(_this.username);\n\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  makeObservable(this, {\n    users: observable.deep,\n    username: observable,\n    score: observable,\n    history: observable,\n    login: action,\n    createUserAndLogin: action,\n    spin: action\n  });\n});\n\nexport var appStore = persistence({\n  name: \"AppStore\",\n  properties: [\"users\", \"username\", \"score\", \"history\"],\n  adapter: new StorageAdapter({\n    read: readStore,\n    write: writeStore\n  })\n})(new AppStore());","map":{"version":3,"names":["observable","action","makeObservable","persistence","StorageAdapter","isPersistence","readStore","writeStore","nanoid","AppStore","users","username","score","history","getUserIndex","name","findIndex","user","createUserAndLogin","newUser","push","login","foundUserIndex","logout","updateUser","updateHistory","slots","draw","id","join","time","Date","toLocaleTimeString","spin","amount","toFixed","deep","appStore","properties","adapter","read","write"],"sources":["/Users/m1/Desktop/source/2022/study-web3-smart-contract/casino-777/src/store/AppStore.js"],"sourcesContent":["import { observable, action, makeObservable } from \"mobx\";\nimport { persistence, StorageAdapter, isPersistence } from \"mobx-persist-store\";\n\nimport { readStore, writeStore } from \"../common/helpers\";\nimport { nanoid } from \"nanoid\";\n\nclass AppStore {\n  users = [];\n  username = null;\n  score = null;\n  history = [];\n\n  constructor() {\n    makeObservable(this, {\n      users: observable.deep,\n      username: observable,\n      score: observable,\n      history: observable,\n      login: action,\n      createUserAndLogin: action,\n      spin: action\n    });\n  }\n\n  getUserIndex = (name) => {\n    return this.users.findIndex((user) => user.username === name);\n  };\n\n  createUserAndLogin = (name) => {\n    const newUser = {\n      username: name,\n      score: 99.99,\n      history: []\n    };\n\n    this.users.push(newUser);\n\n    this.username = newUser.username;\n    this.score = newUser.score;\n    this.history = newUser.history;\n  };\n\n  login = async (name) => {\n    const foundUserIndex = this.getUserIndex(name);\n\n    if (foundUserIndex !== -1) {\n      const { username, score, history } = await this.users[foundUserIndex];\n\n      this.username = username;\n      this.score = score;\n      this.history = history;\n\n      return;\n    }\n\n    this.createUserAndLogin(name);\n  };\n\n  logout = async () => {\n    this.username = null;\n    this.score = null;\n    this.history = [];\n  };\n\n  updateUser = (name) => {\n    const foundUserIndex = this.getUserIndex(name);\n\n    this.users[foundUserIndex] = {\n      username: this.username,\n      score: this.score,\n      history: this.history\n    };\n  };\n\n  updateHistory = (slots) => {\n    const draw = {\n      id: nanoid(),\n      slots: slots.join(\" \"),\n      time: new Date().toLocaleTimeString()\n    };\n\n    this.history.push(draw);\n  };\n\n  spin = async ({ amount, slots }) => {\n    // spin fee\n    this.score -= 1;\n\n    this.score = (this.score + amount).toFixed(2);\n\n    await this.updateHistory(slots);\n\n    // update user in users array\n    this.updateUser(this.username);\n  };\n}\n\nexport const appStore = persistence({\n  name: \"AppStore\",\n  properties: [\"users\", \"username\", \"score\", \"history\"],\n  adapter: new StorageAdapter({\n    read: readStore,\n    write: writeStore\n  })\n})(new AppStore());\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}